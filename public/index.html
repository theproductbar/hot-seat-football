<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Hot Seat Football — QB / Receiver Spinner</title>

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    html, body { height: 100%; }

    body{
      width:100vw;
      min-height:100vh;     /* fallback */
      min-height:100dvh;    /* modern */
      min-height:100svh;    /* iOS fix */
      display:flex;
      justify-content:center;
      align-items:center;
      background:#000;
      overflow:hidden;
      color:#fff;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    }

    .stage{
      position:relative;
      width:100vw;
      height:100vh;         /* fallback */
      height:100dvh;
      height:100svh;
      display:flex;
      justify-content:center;
      align-items:center;
      background:#000;
      padding-bottom: env(safe-area-inset-bottom);
    }

    /* Image (NO STRETCH — iPhone-style contain) */
    #image {
      max-width: 100vw;
      max-height: 100vh;
      width: auto;
      height: auto;
      object-fit: contain;
      display: none;
      z-index: 5;
      border-radius: 14px;
      box-shadow: 0 22px 60px rgba(0,0,0,0.8);
    }

    /* soft overlay depth */
    .veil{
      position:absolute;inset:0;
      background:radial-gradient(circle at 50% 35%, rgba(255,255,255,0.06), rgba(0,0,0,0.92) 55%, rgba(0,0,0,0.98) 100%);
      pointer-events:none;z-index:6;
    }

    /* Center spinning label */
    .spinLabel {
      position:absolute;
      left:50%; top:50%;
      transform:translate(-50%,-50%);
      font-weight:900;
      letter-spacing:0.18em;
      text-transform:uppercase;
      font-size:14px;
      padding:18px 26px;
      border-radius:999px;
      background:rgba(0,0,0,0.72);
      backdrop-filter:blur(10px);
      box-shadow:0 18px 40px rgba(0,0,0,0.65);
      z-index:50;
      display:none;
      pointer-events:none;
      animation: pulse 0.7s ease-in-out infinite;
      text-align:center;
      white-space:nowrap;
    }

    @keyframes pulse {
      0%   { opacity:0.7; transform:translate(-50%,-50%) scale(1.0); }
      50%  { opacity:1;   transform:translate(-50%,-50%) scale(1.12); }
      100% { opacity:0.7; transform:translate(-50%,-50%) scale(1.0); }
    }

    /* Bottom label pill (MOBILE SAFE) */
    .bottomPill{
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      bottom: calc(92px + env(safe-area-inset-bottom)); /* above buttons */
      z-index:80;

      background:rgba(0,0,0,0.75);
      backdrop-filter: blur(10px);
      padding:12px 14px;
      border-radius:999px;
      font-weight:900;
      letter-spacing:0.10em;
      text-transform:uppercase;
      box-shadow:0 18px 60px rgba(0,0,0,0.7);
      color:#fff;

      width:min(94vw, 720px);
      max-width:94vw;
      text-align:center;

      white-space:normal;       /* allow wrap */
      overflow-wrap:anywhere;   /* prevent cutoff */
      line-height:1.2;
    }
    .bottomPill .gold{ color:#facc15; }

    /* Controls (two buttons only) — MOBILE SAFE */
    .controls{
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      bottom: calc(14px + env(safe-area-inset-bottom));
      display:flex;
      gap:10px;
      z-index:90;

      width:min(94vw, 520px);
      justify-content:center;
      pointer-events:auto;
      flex-wrap:wrap;
    }

    button{
      appearance:none;border:none;cursor:pointer;
      border-radius:999px;

      background:rgba(255,255,255,0.18);
      color:#fff;
      backdrop-filter:blur(10px);
      box-shadow:0 18px 60px rgba(0,0,0,0.7);
      transition:transform 0.15s ease, background 0.15s ease, opacity 0.15s ease;

      flex: 1 1 160px;
      min-width: 140px;
      max-width: 260px;

      padding: 16px 16px;
      font-weight:900;
      letter-spacing:0.10em;
      text-transform:uppercase;
      font-size:13px;
      white-space:nowrap;
    }
    button:hover{ transform:translateY(-1px); background:rgba(255,255,255,0.24); }
    button:active{ transform:translateY(1px) scale(0.99); }

    .disabled{
      opacity:0.35;
      pointer-events:none;
    }

    /* Fancy touchdown flash (kept) */
    .flash {
      position:absolute;
      inset:0;
      z-index:120;
      pointer-events:none;
      opacity:0;
      background:
        radial-gradient(circle at 50% 50%, rgba(255,255,255,0.9), rgba(255,255,255,0.0) 55%),
        linear-gradient(90deg, rgba(250,204,21,0.45), rgba(168,85,247,0.35), rgba(59,130,246,0.35));
      mix-blend-mode: screen;
    }
    .flash.play {
      animation: flashAnim 650ms ease-out 1;
    }
    @keyframes flashAnim{
      0%   { opacity:0; }
      15%  { opacity:1; }
      40%  { opacity:0.65; }
      100% { opacity:0; }
    }

    /* Ultra-visible full-screen flash overlay */
    #tdFlash{
      position: fixed;
      inset: 0;
      background: white;
      opacity: 0;
      pointer-events: none;
      z-index: 9999;
    }
    #tdFlash.flash{
      animation: tdFlashAnim 900ms ease-in-out 1;
    }
    @keyframes tdFlashAnim{
      0%   { opacity:0; }
      10%  { opacity:0.95; }
      20%  { opacity:0.05; }
      30%  { opacity:0.95; }
      45%  { opacity:0.10; }
      60%  { opacity:0.95; }
      100% { opacity:0; }
    }

    /* Extra-tight phones */
    @media (max-width: 420px){
      .spinLabel{ font-size:12px; padding:14px 18px; }
      .bottomPill{ font-size:12px; letter-spacing:0.08em; padding:10px 10px; }
      button{ padding:14px 12px; font-size:12px; letter-spacing:0.08em; min-width:130px; }
    }

    /* Short screens (iPhone landscape / small height) */
    @media (max-height: 740px){
      .bottomPill{ bottom: calc(84px + env(safe-area-inset-bottom)); }
      button{ padding: 14px 14px; font-size: 12px; }
      .spinLabel{ font-size: 12px; padding: 14px 18px; }
    }
  </style>
</head>

<body>
  <div class="stage">
    <img id="image" alt="">
    <div class="veil"></div>

    <div class="spinLabel" id="spinLabel">SPINNING…</div>

    <div class="bottomPill" id="bottomPill">
      PRESS <span class="gold">QB PASS</span> OR <span class="gold">RECEIVER</span>
    </div>

    <div class="controls">
      <button id="btnQB">QB PASS</button>
      <button id="btnReceiver">RECEIVER</button>
    </div>

    <div class="flash" id="flash"></div>
  </div>

  <div id="tdFlash"></div>

  <script>
    // ========= SETTINGS (edit here) =========
    const SPIN_SPEED_MS = 90;
    const QB_SPIN_MS = 5400;
    const RECEIVER_SPIN_MS = 5400;
    // =======================================

    const img = document.getElementById("image");
    const spinLabel = document.getElementById("spinLabel");
    const bottomPill = document.getElementById("bottomPill");
    const flash = document.getElementById("flash");
    const tdFlash = document.getElementById("tdFlash");

    const btnQB = document.getElementById("btnQB");
    const btnReceiver = document.getElementById("btnReceiver");

    let spinning = false;
    let spinInterval = null;
    let spinTimeout = null;

    function setButtonsDisabled(disabled){
      if (disabled){
        btnQB.classList.add("disabled");
        btnReceiver.classList.add("disabled");
      } else {
        btnQB.classList.remove("disabled");
        btnReceiver.classList.remove("disabled");
      }
    }

    async function fetchJSON(endpoint){
      const res = await fetch(endpoint + (endpoint.includes("?") ? "&" : "?") + "t=" + Date.now());
      if (!res.ok) throw new Error(await res.text());
      return await res.json();
    }

    async function getRandomImage(type){
      return await fetchJSON(`/api/random-image?type=${encodeURIComponent(type)}`);
    }
    async function getRandomPlayer(){
      return await fetchJSON(`/api/random-player`);
    }
    async function getRandomCatch(){
      return await fetchJSON(`/api/random-catch`);
    }

    function playTouchdownFlash(){
      flash.classList.remove("play");
      void flash.offsetWidth;
      flash.classList.add("play");
    }
    function triggerTouchdownFlash(){
      tdFlash.classList.remove("flash");
      void tdFlash.offsetWidth;
      tdFlash.classList.add("flash");
    }

    function clearSpinTimers(){
      if (spinInterval) clearInterval(spinInterval);
      if (spinTimeout) clearTimeout(spinTimeout);
      spinInterval = null;
      spinTimeout = null;
    }

    async function spin(type){
      if (spinning) return;
      spinning = true;
      setButtonsDisabled(true);

      img.style.display = "block";
      spinLabel.textContent = (type === "QB") ? "QB PASSING…" : "CATCHING…";
      spinLabel.style.display = "block";

      const duration = (type === "QB") ? QB_SPIN_MS : RECEIVER_SPIN_MS;

      spinInterval = setInterval(async () => {
        try {
          const data = await getRandomImage(type);
          img.src = data.url;
        } catch(e) {}
      }, SPIN_SPEED_MS);

      spinTimeout = setTimeout(async () => {
        clearSpinTimers();

        try {
          const data = await getRandomImage(type);
          img.src = data.url;

          if (type === "QB") {
            const p = await getRandomPlayer();
            bottomPill.innerHTML = `PASS TO: <span class="gold">${(p.name || "(ERROR)")}</span>`;
          } else {
            const c = await getRandomCatch();
            const txt = (c.catch || "(ERROR)");
            bottomPill.innerHTML = `CATCH: <span class="gold">${txt}</span>`;

            const up = String(txt).toUpperCase();
            const isTD = up.includes("TOUCHDOWN") || up.includes("TD");
            if (isTD){
              playTouchdownFlash();
              triggerTouchdownFlash();
            }
          }

          spinLabel.style.display = "none";
        } catch(e) {
          spinLabel.style.display = "none";
          bottomPill.innerHTML = `<span class="gold">ERROR</span> LOADING. CHECK CSV FILES.`;
        }

        spinning = false;
        setButtonsDisabled(false);
      }, duration);
    }

    btnQB.addEventListener("click", () => spin("QB"));
    btnReceiver.addEventListener("click", () => spin("Receiver"));

    (async function init(){
      try {
        const data = await getRandomImage("QB");
        img.src = data.url;
        img.style.display = "block";
      } catch {}
    })();
  </script>
</body>
</html>