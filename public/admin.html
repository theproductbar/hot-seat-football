<script>
  const $ = (id) => document.getElementById(id);

  const input = $("playerInput");
  const addBtn = $("addBtn");
  const refreshBtn = $("refreshBtn");
  const list = $("playersList");
  const msg = $("msg");

  function setMsg(text, isError=false){
    msg.textContent = text || "";
    msg.style.color = isError ? "#ff5a5a" : "#9cff9c";
  }

  async function api(path, opts){
    const r = await fetch(path, opts);
    const text = await r.text();
    let data;
    try { data = JSON.parse(text); }
    catch { throw new Error(text || "Bad response"); }
    if(!r.ok) throw new Error(data.error || data.details || "Request failed");
    return data;
  }

  function render(players){
    list.innerHTML = "";
    players.forEach((name) => {
      const row = document.createElement("div");
      row.className = "row";

      const label = document.createElement("div");
      label.className = "name";
      label.textContent = name;

      const del = document.createElement("button");
      del.className = "del";
      del.textContent = "Ã—";
      del.onclick = async () => {
        try{
          del.disabled = true;
          setMsg("");
          const data = await api("/api/admin/receiver-players", {
            method: "DELETE",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name })
          });
          render(data.players || []);
        }catch(e){
          setMsg("Error: " + e.message, true);
        }finally{
          del.disabled = false;
        }
      };

      row.appendChild(label);
      row.appendChild(del);
      list.appendChild(row);
    });
  }

  async function load(){
    try{
      setMsg("");
      const data = await api("/api/admin/receiver-players");
      render(data.players || []);
    }catch(e){
      setMsg("Load failed: " + e.message, true);
    }
  }

  addBtn.onclick = async () => {
    const name = (input.value || "").trim();
    if(!name) return setMsg("Error: Missing name", true);

    try{
      addBtn.disabled = true;
      setMsg("");
      const data = await api("/api/admin/receiver-players", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name })
      });
      input.value = "";
      render(data.players || []);
    }catch(e){
      setMsg("Error: " + e.message, true);
    }finally{
      addBtn.disabled = false;
    }
  };

  refreshBtn.onclick = load;

  load();
</script>