<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Receiver Players Admin</title>

  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      min-height:100svh;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      background:#000;
      color:#fff;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      overflow:hidden;
      padding:
        calc(10px + env(safe-area-inset-top))
        calc(10px + env(safe-area-inset-right))
        calc(10px + env(safe-area-inset-bottom))
        calc(10px + env(safe-area-inset-left));
    }

    /* Mobile-first container */
    .wrap{
      width: min(980px, 100%);
      max-height: 100svh;
      overflow:hidden;
      border-radius:24px;
      background:rgba(255,255,255,0.04);
      border:1px solid rgba(255,255,255,0.08);
      box-shadow:0 30px 120px rgba(0,0,0,.75);
      position:relative;
      padding:18px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    /* Header becomes compact on mobile */
    .header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
    }

    h1{
      font-size:22px;              /* mobile */
      letter-spacing:.24em;
      text-transform:uppercase;
      font-weight:900;
      line-height:1.15;
      max-width: 78%;
      word-break: break-word;
    }

    .sub{
      margin-top:8px;
      color:rgba(255,255,255,0.75);
      font-size:14px;              /* mobile */
      line-height:1.25;
      max-width: 92%;
    }

    .back{
      appearance:none;
      border:none;
      cursor:pointer;
      border-radius:999px;
      padding:10px 14px;
      background:rgba(0,0,0,0.45);
      border:1px solid rgba(255,255,255,0.14);
      color:#fff;
      letter-spacing:.18em;
      text-transform:uppercase;
      font-weight:900;
      font-size:11px;
      box-shadow:0 12px 40px rgba(0,0,0,0.5);
      user-select:none;
      flex:0 0 auto;
    }

    /* Form layout: input full width, buttons NEVER overflow */
    .rowTop{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
      align-items:center;
      margin-top:6px;
    }

    input{
      width:100%;
      height:56px;
      padding:0 18px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.12);
      background:rgba(0,0,0,0.35);
      color:#fff;
      font-size:18px;
      outline:none;
    }
    input::placeholder{ color:rgba(255,255,255,0.35); }

    .btnRow{
      display:grid;
      grid-template-columns: 1fr 1fr; /* Add + Refresh side-by-side on mobile */
      gap:12px;
    }

    .btn{
      height:56px;
      width:100%;
      border-radius:999px;
      border:none;
      cursor:pointer;
      font-weight:900;
      text-transform:uppercase;
      letter-spacing:.16em;
      font-size:13px;
      box-shadow:0 22px 60px rgba(0,0,0,0.7);
      user-select:none;
      white-space:nowrap;
    }

    .btnAdd{ background:#facc15; color:#111; }
    .btnRefresh{
      background:rgba(255,255,255,0.18);
      color:#fff;
      border:1px solid rgba(255,255,255,0.10);
    }

    .btn:disabled{ opacity:.55; cursor:not-allowed; }

    #msg{
      min-height:22px;
      font-size:14px;
      color:#9cff9c;
      margin-top:2px;
    }

    .divider{
      height:1px;
      background:rgba(255,255,255,0.10);
      margin:6px 0 2px;
    }

    /* List should scroll INSIDE the card, on mobile */
    #playersList{
      flex:1 1 auto;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      padding-right:4px;
    }

    .row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:14px 2px;
      border-bottom:1px solid rgba(255,255,255,0.10);
    }

    .name{
      font-size:22px;
      font-weight:900;
      color:rgba(255,255,255,0.95);
      max-width: calc(100% - 64px);
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }

    .del{
      width:46px;
      height:46px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,0.14);
      background:rgba(0,0,0,0.35);
      color:#fff;
      font-size:26px;
      font-weight:900;
      cursor:pointer;
      box-shadow:0 12px 30px rgba(0,0,0,0.45);
      user-select:none;
      flex:0 0 auto;
    }
    .del:disabled{opacity:.55;cursor:not-allowed;}

    .hint{
      color:rgba(255,255,255,0.55);
      font-size:12px;
      line-height:1.3;
      margin-top:4px;
    }

    /* Desktop upgrades (only when screen is bigger) */
    @media (min-width: 720px){
      .wrap{ padding:26px; border-radius:28px; }
      h1{ font-size:36px; }
      .sub{ font-size:18px; }
      .rowTop{
        grid-template-columns: 1fr auto;
        column-gap:16px;
        align-items:center;
      }
      .btnRow{
        grid-template-columns: auto auto;
        gap:14px;
      }
      input{ height:66px; font-size:22px; padding:0 22px; }
      .btn{ height:66px; font-size:15px; padding:0 28px; }
      .name{ font-size:30px; }
      .del{ width:54px; height:54px; font-size:28px; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="header">
      <div>
        <h1>Receiver Players Admin</h1>
        <div class="sub">Add/remove players before the game. (Updates Google Sheet.)</div>
      </div>
      <button class="back" onclick="location.href='/'">Back</button>
    </div>

    <div class="rowTop">
      <input id="playerInput" placeholder="Add player name..." autocomplete="off" />
      <div class="btnRow">
        <button id="addBtn" class="btn btnAdd">Add</button>
        <button id="refreshBtn" class="btn btnRefresh">Refresh</button>
      </div>
    </div>

    <div id="msg"></div>

    <div class="divider"></div>

    <div id="playersList"></div>

    <div class="hint">Tip: If multiple people are editing at once, press Refresh to sync instantly.</div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    const input = $("playerInput");
    const addBtn = $("addBtn");
    const refreshBtn = $("refreshBtn");
    const list = $("playersList");
    const msg = $("msg");

    function setMsg(text, isError=false){
      msg.textContent = text || "";
      msg.style.color = isError ? "#ff5a5a" : "#9cff9c";
    }

    async function api(path, opts){
      const r = await fetch(path, opts);
      const text = await r.text();
      let data;
      try { data = JSON.parse(text); }
      catch { throw new Error(text || "Bad response"); }
      if(!r.ok) throw new Error(data.error || data.details || "Request failed");
      return data;
    }

    function render(players){
      list.innerHTML = "";
      (players || []).forEach((name) => {
        const row = document.createElement("div");
        row.className = "row";

        const label = document.createElement("div");
        label.className = "name";
        label.textContent = name;

        const del = document.createElement("button");
        del.className = "del";
        del.textContent = "Ã—";

        del.onclick = async () => {
          try{
            del.disabled = true;
            setMsg("");
            await api("/api/admin/receiver-players", {
              method: "DELETE",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ name })
            });
            await load();
          }catch(e){
            setMsg("Error: " + e.message, true);
          }finally{
            del.disabled = false;
          }
        };

        row.appendChild(label);
        row.appendChild(del);
        list.appendChild(row);
      });
    }

    async function load(){
      try{
        setMsg("");
        const data = await api("/api/admin/receiver-players");
        render(data.players || []);
      }catch(e){
        setMsg("Load failed: " + e.message, true);
      }
    }

    addBtn.onclick = async () => {
      const name = (input.value || "").trim();
      if(!name) return setMsg("Error: Missing name", true);

      try{
        addBtn.disabled = true;
        setMsg("");
        await api("/api/admin/receiver-players", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name })
        });
        input.value = "";
        await load();
      }catch(e){
        setMsg("Error: " + e.message, true);
      }finally{
        addBtn.disabled = false;
      }
    };

    refreshBtn.onclick = load;

    input.addEventListener("keydown", (e) => {
      if(e.key === "Enter") addBtn.click();
    });

    load();
  </script>
</body>
</html>